<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 	<mapper namespace="com.mbc.mid.dao.ParkingLogDao">
 	
 	<!-- 차량 입차 시 -->
 	<insert id="insertEntryLog" parameterType="String">
        INSERT INTO parking_log (vehicle_num) VALUES (#{vehicleNum})
    </insert>
    
    <!-- 차량 출차 시, 최근부터 입차 기록 검색 -->
    <select id="selectRecentEntryLog" parameterType="String" resultType="com.mbc.mid.dto.ParkingLogDto">
        SELECT * FROM parking_log 
        WHERE vehicle_num = #{vehicleNum} AND exit_time IS NULL 
        ORDER BY entry_time DESC LIMIT 1
    </select>

	<!-- 출차 기록 업데이트 -->
    <update id="updateExitLog" parameterType="com.mbc.mid.dto.ParkingLogDto">
        UPDATE parking_log 
        SET exit_time = now(), is_member = #{isMember} 
        WHERE parking_log_id = #{parkingLogId}
    </update>
    
    <!-- 결제 여부 업데이트 -->
    <update id="updatePaymentStatus" parameterType="Long">
        UPDATE parking_log SET payment_status = true WHERE parking_log_id = #{parkingLogId}
    </update>
  
</mapper>